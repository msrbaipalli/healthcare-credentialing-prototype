<div class="grid kpi">
    <mat-card class="kpi-card">
        <div class="kpi-value">{{ kpis().total }}</div>
        <div class="kpi-label">Providers</div>
    </mat-card>
    <mat-card class="kpi-card">
        <div class="kpi-value">{{ kpis().verified }}</div>
        <div class="kpi-label">Verified</div>
    </mat-card>
    <mat-card class="kpi-card">
        <div class="kpi-value">{{ kpis().warning }}</div>
        <div class="kpi-label">Needs Attention</div>
    </mat-card>
    <mat-card class="kpi-card">
        <div class="kpi-value">{{ kpis().failed }}</div>
        <div class="kpi-label">Failed</div>
    </mat-card>
    <mat-card class="kpi-card">
        <div class="kpi-value">{{ kpis().pending }}</div>
        <div class="kpi-label">Pending</div>
    </mat-card>
</div>

<mat-card class="search">
    <mat-icon>search</mat-icon>
    <input matInput [formControl]="query" placeholder="Search providers, NPI, org, state..." />
</mat-card>

<div class="grid main">
    <mat-card class="panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">Verification Queue</div>
                <div class="panel-subtitle">Operational review for exceptions and approvals</div>
            </div>
        </div>

        <table mat-table [dataSource]="filtered()" class="table">
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let p">
                    <span [class]="statusChipClass(p.status)">
                        <mat-icon class="chip-icon">{{ statusIcon(p.status) }}</mat-icon>
                        {{ statusLabel(p.status) }}
                    </span>
                </td>
            </ng-container>

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Provider</th>
                <td mat-cell *matCellDef="let p" class="clickable" (click)="openProfile(p)">
                    <div class="cell-title">{{ p.fullName }}</div>
                    <div class="cell-sub">{{ p.organization }}</div>
                </td>
            </ng-container>

            <ng-container matColumnDef="npi">
                <th mat-header-cell *matHeaderCellDef>NPI</th>
                <td mat-cell *matCellDef="let p">{{ p.npi }}</td>
            </ng-container>

            <ng-container matColumnDef="specialty">
                <th mat-header-cell *matHeaderCellDef>Specialty</th>
                <td mat-cell *matCellDef="let p">{{ p.specialty }}</td>
            </ng-container>

            <ng-container matColumnDef="risk">
                <th mat-header-cell *matHeaderCellDef>Risk</th>
                <td mat-cell *matCellDef="let p">
                    <div class="risk-row" matTooltip="Mock risk score (0–100)">
                        <mat-progress-bar mode="determinate" [value]="p.riskScore"></mat-progress-bar>
                        <div class="risk-score">{{ p.riskScore }}</div>
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="lastVerified">
                <th mat-header-cell *matHeaderCellDef>Last Verified</th>
                <td mat-cell *matCellDef="let p">{{ p.lastVerifiedAt | date:'MMM d, y · h:mm a' }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="queueColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: queueColumns;" [class.selected]="selectedSig()?.id === row.id">
            </tr>
        </table>
    </mat-card>

    <mat-card class="panel" *ngIf="selectedSig() as p; else emptyState">
        <div class="panel-header detail-head">
            <div class="detail-title">
                <div class="title-row">
                    <div class="h1">{{ p.fullName }}</div>
                    <span [class]="statusChipClass(p.status)">
                        <mat-icon class="chip-icon">{{ statusIcon(p.status) }}</mat-icon>
                        {{ statusLabel(p.status) }}
                    </span>
                </div>
                <div class="muted">
                    NPI {{ p.npi }} · {{ p.specialty }} · {{ p.organization }} · {{ p.state }}
                </div>
            </div>

            <div class="detail-actions">
                <button mat-stroked-button (click)="requestMoreInfo()">
                    <mat-icon>mark_email_unread</mat-icon>
                    Request Info
                </button>
                <button mat-flat-button (click)="approve()">
                    <mat-icon>check_circle</mat-icon>
                    Approve
                </button>
            </div>
        </div>

        <mat-divider></mat-divider>

        <div class="detail-grid">
            <div class="stack">
                <div class="section-title">Real-time Verification Checks</div>
                <mat-card class="inner" *ngFor="let c of checks()">
                    <div class="row">
                        <div class="left">
                            <div class="cell-title">{{ c.name }}</div>
                            <div class="cell-sub">{{ c.source }} · {{ c.checkedAt | date:'h:mm a' }}</div>
                        </div>
                        <span [class]="statusChipClass(c.status)">
                            <mat-icon class="chip-icon">{{ statusIcon(c.status) }}</mat-icon>
                            {{ statusLabel(c.status) }}
                        </span>
                    </div>
                    <div class="detail-text">{{ c.details }}</div>
                </mat-card>
            </div>

            <div class="stack">
                <div class="section-title">Blockchain Audit Ledger (Mock)</div>
                <mat-card class="inner ledger" *ngFor="let e of ledger()">
                    <div class="row">
                        <div class="left">
                            <div class="cell-title">{{ e.action }}</div>
                            <div class="cell-sub">{{ e.timestamp | date:'MMM d, y · h:mm a' }} · {{ e.actor }}</div>
                        </div>
                        <div class="hash">{{ e.txHash }}</div>
                    </div>
                    <div class="detail-text">{{ e.summary }}</div>
                </mat-card>

                <mat-card class="inner callout">
                    <mat-icon>lock</mat-icon>
                    <div>
                        <div class="cell-title">Immutability + Auditability</div>
                        <div class="cell-sub">Append-only trail suitable for compliance review.</div>
                    </div>
                </mat-card>
            </div>
        </div>
    </mat-card>

    <ng-template #emptyState>
        <mat-card class="panel empty">
            <mat-icon>person_search</mat-icon>
            <div class="h1">Select a provider</div>
            <div class="muted">Search above to view verification and ledger details.</div>
        </mat-card>
    </ng-template>
</div>